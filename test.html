<!DOCTYPE html>
<html>
<head>
    <title>Translation Test</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 20px; 
            background: #f0f0f0; 
        }
        .container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            max-width: 800px;
            margin: 0 auto;
        }
        select, textarea, button {
            margin: 10px 0;
            padding: 8px;
            font-size: 14px;
        }
        select {
            background: white;
            color: #333;
            border: 1px solid #ccc;
            min-width: 150px;
        }
        select option {
            background: white;
            color: #333;
        }
        textarea {
            width: 100%;
            height: 100px;
            resize: vertical;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 10px 20px;
        }
        button:hover {
            background: #45a049;
        }
        #result {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-height: 50px;
        }
        .error {
            color: red;
            font-weight: bold;
        }
        .success {
            color: green;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Translation Test</h1>
        
        <h2>API Availability Test</h2>
        <div id="apiStatus">Checking APIs...</div>
        
        <h2>Language Selection Test</h2>
        <label>From Language:</label>
        <select id="fromLang">
            <option value="auto">Auto-detect</option>
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="th">Thai</option>
            <option value="lo">Lao</option>
            <option value="hmn">Hmong</option>
            <option value="km">Khmer</option>
        </select>
        
        <label>To Language:</label>
        <select id="toLang">
            <option value="en">English</option>
            <option value="es">Spanish</option>
            <option value="fr">French</option>
            <option value="th">Thai</option>
            <option value="lo">Lao</option>
            <option value="hmn">Hmong</option>
            <option value="km">Khmer</option>
        </select>
        
        <h2>Translation Test</h2>
        <textarea id="inputText" placeholder="Enter text to translate...">Hello, how are you?</textarea>
        
        <div>
            <button onclick="testTranslation()">Test Translation</button>
            <button onclick="testLanguageDetection()">Test Language Detection</button>
            <button onclick="getLanguages()">Load Available Languages</button>
        </div>
        
        <div id="result">Click a button to test functionality...</div>
    </div>

    <script>
        // Check API availability
        function checkAPIs() {
            const status = document.getElementById('apiStatus');
            let statusText = '';
            
            if (typeof window.translator !== 'undefined') {
                statusText += '<span class="success">✓ Translator API available</span><br>';
            } else {
                statusText += '<span class="error">✗ Translator API not available</span><br>';
            }
            
            if (typeof window.electronAPI !== 'undefined') {
                statusText += '<span class="success">✓ Electron API available</span><br>';
            } else {
                statusText += '<span class="error">✗ Electron API not available</span><br>';
            }
            
            status.innerHTML = statusText;
        }
        
        async function testTranslation() {
            const result = document.getElementById('result');
            const inputText = document.getElementById('inputText').value;
            const fromLang = document.getElementById('fromLang').value;
            const toLang = document.getElementById('toLang').value;
            
            if (!inputText.trim()) {
                result.innerHTML = '<span class="error">Please enter text to translate</span>';
                return;
            }
            
            result.innerHTML = 'Translating...';
            
            try {
                if (typeof window.translator !== 'undefined') {
                    const translationResult = await window.translator.translateText(inputText, toLang, fromLang);
                    
                    if (translationResult.success) {
                        result.innerHTML = `
                            <div class="success">Translation successful!</div>
                            <div><strong>Original:</strong> ${translationResult.originalText}</div>
                            <div><strong>Translated:</strong> ${translationResult.translatedText}</div>
                            <div><strong>From:</strong> ${translationResult.sourceLanguage}</div>
                            <div><strong>To:</strong> ${translationResult.targetLanguage}</div>
                        `;
                    } else {
                        result.innerHTML = `<span class="error">Translation failed: ${translationResult.error}</span>`;
                    }
                } else {
                    result.innerHTML = '<span class="error">Translator API not available</span>';
                }
            } catch (error) {
                result.innerHTML = `<span class="error">Error: ${error.message}</span>`;
                console.error('Translation error:', error);
            }
        }
        
        async function testLanguageDetection() {
            const result = document.getElementById('result');
            const inputText = document.getElementById('inputText').value;
            
            if (!inputText.trim()) {
                result.innerHTML = '<span class="error">Please enter text for language detection</span>';
                return;
            }
            
            result.innerHTML = 'Detecting language...';
            
            try {
                if (typeof window.translator !== 'undefined') {
                    const detectionResult = await window.translator.detectLanguage(inputText);
                    
                    if (detectionResult.success) {
                        result.innerHTML = `
                            <div class="success">Language detection successful!</div>
                            <div><strong>Text:</strong> ${detectionResult.text}</div>
                            <div><strong>Detected Language:</strong> ${detectionResult.detectedLanguage}</div>
                        `;
                    } else {
                        result.innerHTML = `<span class="error">Language detection failed: ${detectionResult.error}</span>`;
                    }
                } else {
                    result.innerHTML = '<span class="error">Translator API not available</span>';
                }
            } catch (error) {
                result.innerHTML = `<span class="error">Error: ${error.message}</span>`;
                console.error('Language detection error:', error);
            }
        }
        
        async function getLanguages() {
            const result = document.getElementById('result');
            result.innerHTML = 'Loading languages...';
            
            try {
                if (typeof window.translator !== 'undefined') {
                    const languageResult = await window.translator.getAvailableLanguages();
                    
                    if (languageResult.success) {
                        const languages = Object.entries(languageResult.languages)
                            .map(([name, code]) => `${name}: ${code}`)
                            .join('<br>');
                        
                        result.innerHTML = `
                            <div class="success">Languages loaded successfully!</div>
                            <div><strong>Available Languages:</strong></div>
                            <div style="max-height: 200px; overflow-y: auto; margin-top: 10px;">
                                ${languages}
                            </div>
                        `;
                        
                        // Update dropdowns
                        populateDropdowns(languageResult.languages);
                    } else {
                        result.innerHTML = `<span class="error">Failed to load languages: ${languageResult.error}</span>`;
                    }
                } else {
                    result.innerHTML = '<span class="error">Translator API not available</span>';
                }
            } catch (error) {
                result.innerHTML = `<span class="error">Error: ${error.message}</span>`;
                console.error('Get languages error:', error);
            }
        }
        
        function populateDropdowns(languages) {
            const fromSelect = document.getElementById('fromLang');
            const toSelect = document.getElementById('toLang');
            
            // Clear current options but keep the first ones
            fromSelect.innerHTML = '<option value="auto">Auto-detect</option>';
            toSelect.innerHTML = '<option value="en">English</option>';
            
            Object.entries(languages).forEach(([name, code]) => {
                if (code !== 'auto') {
                    const capitalizedName = name.charAt(0).toUpperCase() + name.slice(1);
                    
                    // Add to source language
                    const fromOption = document.createElement('option');
                    fromOption.value = code;
                    fromOption.textContent = capitalizedName;
                    fromSelect.appendChild(fromOption);
                    
                    // Add to target language (skip English as it's already there)
                    if (code !== 'en') {
                        const toOption = document.createElement('option');
                        toOption.value = code;
                        toOption.textContent = capitalizedName;
                        toSelect.appendChild(toOption);
                    }
                }
            });
        }
        
        // Run checks when page loads
        document.addEventListener('DOMContentLoaded', () => {
            checkAPIs();
            
            // Try to load languages automatically after a delay
            setTimeout(() => {
                if (typeof window.translator !== 'undefined') {
                    getLanguages();
                }
            }, 1000);
        });
    </script>
</body>
</html>
